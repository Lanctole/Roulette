@page "/ranobe"
@inherits ShikimoriComponent
@using ShikimoriSharp.Bases
@using Genres = Roulette.Components.Pages.Shikimori.Genres
@using MediaList = Roulette.Components.Pages.Shikimori.MediaList
@using Roulette.Services
@inject ApiClientService ApiClientService
@inject IJSRuntime JS

<PageTitle>Ranobe</PageTitle>

<Row Gutter="16">
    <Col Xs="24" Sm="12" Md="8">
    <Genres IsAnime="false" SelectedGenresChanged="OnSelectedGenresChanged" />
    </Col>
    <Col Xs="24" Sm="12" Md="8">
    <MinimalScoreComponent @bind-SelectedScore="SelectedScore" />
    </Col>

</Row>
<Divider Orientation="left"></Divider>

<YearSelectionComponent @bind-selectedFromYear="SelectedFromYear" @bind-selectedToYear="SelectedToYear" />

<p>Временной период: с @SelectedFromYear до @SelectedToYear</p>

<Button OnClick="SendSelected">Roll!</Button> 
<WheelComponent />
<MediaList MediaItems="_ranobes" />

@code {
    private List<SmallRepresentation>? _ranobes;

    private async Task SendSelected()
    {
        _ranobes = await GetMediaItemsAsync("ranobe/ranobes?", async (id) =>
        {
            var url = $"ranobe/ranobes/{id}?";
            return await ApiClientService.GetRanobeByIdAsync(url);
        });
        List<String> _mediaName = new();
        foreach (var media in _ranobes)
        {
            if (media.Russian != "")
            {
                _mediaName.Add(media.Russian);
            }
            else
            {
                _mediaName.Add(media.Name);
            }
            
        }
        JS.InvokeVoidAsync("startSpin", _mediaName);
    }
}
